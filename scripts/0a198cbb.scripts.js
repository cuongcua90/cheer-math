"use strict";angular.module("mathApp",["ngCookies","ngResource","ngSanitize","ngRoute","timer"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("mathApp").controller("MainCtrl",["$scope","Gamemanagerservice","Mathservice","$timeout","$window","$log",function(a,b,c,d){a.init=function(){a.trueAudio=document.createElement("audio"),a.trueAudio.src="../../media/right.wav",a.wrongAudio=document.createElement("audio"),a.wrongAudio.src="../../media/wrong.wav"},a.init(),a.startTimer=function(){a.$broadcast("timer-start")},a.newGame=function(){a.expression=b.generate(0),a.checkingAnswer=!1,a.gameOver=!1,a.startTimer(),a.score=0,a.consecutiveNumber=0,a.level=1},a.nextGame=function(){a.expression=b.generate(a.level-1),a.checkingAnswer=!1},a.gameCheck=function(){a.checkingAnswer=!0;var c=a.expression.chain.indexOf(-1);return-1!==c?(a.showTrue=!1,a.gameOver=!0,a.stopTimer(),!1):(a.showTrue=b.isCorrectExpression(a.expression),a.showTrue?(a.trueAudio.play(),a.trueAudio.currentTime=0,a.consecutiveNumber++,a.consecutiveNumber>=5&&(a.level<4&&a.level++,a.consecutiveNumber=0,a.$broadcast("timer-add-cd-seconds",4+a.level)),a.score++):(a.gameOver=!0,a.stopTimer()),a.showTrue)},a.newGame(),a.plusButtonClick=function(){if(!a.gameOver){var b=a.expression.chain.indexOf(-1);-1!==b&&(a.expression.chain[b]=0,b=a.expression.chain.indexOf(-1),-1===b&&(a.gameCheck()?d(a.nextGame,500):a.wrongAudio.play()))}},a.minusButtonClick=function(){if(!a.gameOver){var b=a.expression.chain.indexOf(-1);-1!==b&&(a.expression.chain[b]=1,b=a.expression.chain.indexOf(-1),-1===b&&(a.gameCheck()?d(a.nextGame,500):a.wrongAudio.play()))}},a.stopTimer=function(){a.$broadcast("timer-stop")},a.$on("timer-stopped",function(){a.gameOver=!0,a.stopTimer()}),a.onKeyDown=function(b){37===b.keyCode?a.plusButtonClick():39===b.keyCode&&a.minusButtonClick()}}]),angular.module("mathApp").factory("Gamemanagerservice",["Mathservice",function(a){var b=[{min:0,max:10,numOfFactor:2},{min:0,max:50,numOfFactor:2},{min:0,max:10,numOfFactor:3},{min:0,max:100,numOfFactor:3}];return{generate:function(c){return a.generateExpression(b[c])},isCorrectExpression:function(a){for(var b=a.chain,c=b[0],d=1;d<b.length-1;d+=2)if(0===b[d])c+=b[d+1];else{if(1!==b[d])return!1;c-=b[d+1]}return a.result===c}}}]),angular.module("mathApp").factory("Mathservice",function(){return{getRandomNumber:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},generateExpression:function(a){for(var b=[],c=0;c<a.numOfFactor-1;c++)b.push(this.getRandomNumber(0,a.numOfFactor-2));var d=[],e=this.getRandomNumber(a.min,a.max),f=e;d.push(e);for(var g=this.getRandomNumber(1,a.numOfFactor-1),c=1;c<a.numOfFactor;c++){{var h=this.getRandomNumber(a.min,a.max),i=this.getRandomNumber(0,1);-1!==b.indexOf(c-1)}d.push(c===g?-1:i),d.push(h),0===i?f+=h:1===i&&(f-=h)}return{chain:d,result:f}}}});